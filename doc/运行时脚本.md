# 运行时脚本

## 1 介绍

在剧情指令与触发器中，由于许多地方需要使用逻辑判断，因此Next引入了一个C#动态解析库来进行逻辑判断。

编写脚本指令时，可以把脚本指令看作类似于
```C#
var result = xxxx;
```
xxxx即是脚本指令。

例如，在触发器判断中，condition需要返回值为bool的指令，则可以写出如下脚本指令
```C#
roleBindID==609
```
通过判断目标Npc的绑定ID是否为609来决定是否触发。

而在剧情指令SetChar中，需要返回值为int的指令，则可以直接使用
```C#
roleID
```
来返回当前交谈NPC的ID

## 2 脚本环境

脚本在运行时会有一个默认的环境对象，脚本可以直接调用环境里的字段与方法。

当前环境定义的字段与方法如下：

### 2.1 字段
|字段名|类型|说明|
|-|-|-|
|roleID|int|环境角色的实时ID|
|roleBindID|int|环境角色绑定的ID<br/>参考Base里的 `AvatarJsonData.json` 文件|
|roleName|string|角色名称|
|bindNpc|UINPCData|用于查询的角色数据<br/>请自行参考游戏里的`UINpcData`类|
|player|Avatar|<br/>请自行参考游戏里的`KBEngine.Avatar`类|用于查询的角色数据

### 2.2 方法
|方法定义|说明|
|-|-|
|int GetInt(string key)|key : 键<br/><br/>从id为key的键中取出整形值。<br>实际储存位置储存于角色数据的`AvatarChengJiuData`|
|string GetStr(string key)|key : 键<br/><br/>从id为key的键中取出字符串值。<br>实际储存位置储存于角色数据的`AvatarChengJiuData`|
|string GetCall(string man,string woman)|man : 对男性称呼<br/>woman : 对女性称呼<br/><br/>根据主角性别返回称呼|
|bool Before(int year, int month = 12, int day = 31)|year : 年<br/>month : 月<br/>day : 日<br/><br/>判断是否在某个日期之前|
|bool After(int year, int month = 1, int day = 1)|year : 年<br/>month : 月<br/>day : 日<br/><br/>判断是否在某个日期之后|